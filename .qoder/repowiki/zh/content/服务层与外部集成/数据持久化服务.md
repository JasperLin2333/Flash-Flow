# æ•°æ®æŒä¹…åŒ–æœåŠ¡

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [flowAPI.ts](file://src/services/flowAPI.ts)
- [flowStore.ts](file://src/store/flowStore.ts)
- [flow.ts](file://src/types/flow.ts)
- [supabase.ts](file://src/lib/supabase.ts)
- [validation.ts](file://src/utils/validation.ts)
- [page.tsx](file://src/app/flows/page.tsx)
- [page.tsx](file://src/app/builder/[id]/page.tsx)
- [FlowCard.tsx](file://src/components/flows/FlowCard.tsx)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®æ¶æ„æ¦‚è§ˆ](#é¡¹ç›®æ¶æ„æ¦‚è§ˆ)
3. [æ ¸å¿ƒç»„ä»¶åˆ†æ](#æ ¸å¿ƒç»„ä»¶åˆ†æ)
4. [è¯¦ç»†åŠŸèƒ½å®ç°](#è¯¦ç»†åŠŸèƒ½å®ç°)
5. [çŠ¶æ€åŒæ­¥æœºåˆ¶](#çŠ¶æ€åŒæ­¥æœºåˆ¶)
6. [é”™è¯¯å¤„ç†ä¸é™çº§ç­–ç•¥](#é”™è¯¯å¤„ç†ä¸é™çº§ç­–ç•¥)
7. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
8. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
9. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
10. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹

FlowAPIæœåŠ¡æ˜¯Flash Flow SaaSå¹³å°çš„æ ¸å¿ƒæ•°æ®æŒä¹…åŒ–å±‚ï¼Œè´Ÿè´£å°è£…å¯¹Supabaseæ•°æ®åº“çš„æ‰€æœ‰CRUDæ“ä½œã€‚è¯¥æœåŠ¡æä¾›äº†å®Œæ•´çš„å·¥ä½œæµç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å·¥ä½œæµçš„åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ä»¥åŠè‡ªåŠ¨ä¿å­˜ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æ•°æ®éªŒè¯æœºåˆ¶å’Œé”™è¯¯å¤„ç†ç­–ç•¥ï¼Œç¡®ä¿äº†æ•°æ®çš„å®Œæ•´æ€§å’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚

## é¡¹ç›®æ¶æ„æ¦‚è§ˆ

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å±‚æ¬¡ï¼š

```mermaid
graph TB
subgraph "å‰ç«¯ç•Œé¢å±‚"
A[Flowsé¡µé¢] --> B[FlowCardç»„ä»¶]
C[Builderé¡µé¢] --> D[FlowCanvasç»„ä»¶]
end
subgraph "çŠ¶æ€ç®¡ç†å±‚"
E[flowStore] --> F[zustandçŠ¶æ€ç®¡ç†]
end
subgraph "æœåŠ¡å±‚"
G[flowAPI] --> H[Supabaseå®¢æˆ·ç«¯]
end
subgraph "æ•°æ®å±‚"
H --> I[Supabaseæ•°æ®åº“]
H --> J[Storage Bucket]
end
A --> E
C --> E
E --> G
G --> H
```

**å›¾è¡¨æ¥æº**
- [flowStore.ts](file://src/store/flowStore.ts#L1-L131)
- [flowAPI.ts](file://src/services/flowAPI.ts#L1-L240)

**ç« èŠ‚æ¥æº**
- [flowStore.ts](file://src/store/flowStore.ts#L1-L131)
- [flowAPI.ts](file://src/services/flowAPI.ts#L1-L240)

## æ ¸å¿ƒç»„ä»¶åˆ†æ

### FlowAPIæœåŠ¡æ¶æ„

FlowAPIæœåŠ¡æ˜¯ä¸€ä¸ªä¸“é—¨çš„æ•°æ®è®¿é—®å±‚ï¼Œæä¾›äº†ç»Ÿä¸€çš„æ¥å£æ¥æ“ä½œå·¥ä½œæµæ•°æ®ï¼š

```mermaid
classDiagram
class FlowAPI {
+listFlows(ownerId?) Promise~FlowRecord[]~
+getFlow(id) Promise~FlowRecord | null~
+createFlow(name, flowData, ownerId?, description?) Promise~FlowRecord~
+updateFlow(id, updates) Promise~FlowRecord~
+deleteFlow(id) Promise~void~
+autoSave(flowId, name, flowData) Promise~string~
+duplicateFlow(id) Promise~FlowRecord~
}
class FlowRecord {
+string id
+string owner_id
+string name
+string description
+string icon_kind
+string icon_name
+string icon_url
+number node_count
+FlowData data
+string created_at
+string updated_at
}
class FlowData {
+AppNode[] nodes
+AppEdge[] edges
+Viewport viewport
}
FlowAPI --> FlowRecord : "manages"
FlowRecord --> FlowData : "contains"
```

**å›¾è¡¨æ¥æº**
- [flowAPI.ts](file://src/services/flowAPI.ts#L10-L239)
- [flow.ts](file://src/types/flow.ts#L65-L77)

### æ•°æ®ç±»å‹å®šä¹‰

ç³»ç»Ÿå®šä¹‰äº†ä¸¥æ ¼çš„æ•°æ®ç±»å‹æ¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼š

| ç±»å‹ | æè¿° | ä¸»è¦å­—æ®µ |
|------|------|----------|
| FlowRecord | å·¥ä½œæµè®°å½•å¯¹è±¡ | id, owner_id, name, description, icon_* |
| FlowData | å·¥ä½œæµæ•°æ®ç»“æ„ | nodes[], edges[], viewport |
| AppNode | èŠ‚ç‚¹å¯¹è±¡ | id, type, position, data |
| AppEdge | è¾¹å¯¹è±¡ | id, source, target, label |

**ç« èŠ‚æ¥æº**
- [flow.ts](file://src/types/flow.ts#L1-L153)

## è¯¦ç»†åŠŸèƒ½å®ç°

### åˆ—å‡ºæ‰€æœ‰å·¥ä½œæµ (listFlows)

`listFlows`æ–¹æ³•ç”¨äºè·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰å·¥ä½œæµï¼Œæ”¯æŒæŒ‰æ‰€æœ‰è€…è¿‡æ»¤ï¼š

```mermaid
sequenceDiagram
participant Client as å®¢æˆ·ç«¯
participant API as flowAPI
participant Supabase as Supabase
participant Validation as æ•°æ®éªŒè¯
Client->>API : listFlows(ownerId?)
API->>Supabase : æŸ¥è¯¢flowsè¡¨
Supabase-->>API : è¿”å›åŸå§‹æ•°æ®
API->>Validation : éªŒè¯æ•°æ®ç»“æ„
Validation->>Validation : æ£€æŸ¥nodes/edges
Validation->>Validation : å¤„ç†æŸåæ•°æ®
Validation-->>API : è¿”å›æ ‡å‡†åŒ–æ•°æ®
API-->>Client : FlowRecord[]
```

**å›¾è¡¨æ¥æº**
- [flowAPI.ts](file://src/services/flowAPI.ts#L14-L69)

**å…³é”®ç‰¹æ€§ï¼š**
- æ”¯æŒå¯é€‰çš„æ‰€æœ‰è€…IDè¿‡æ»¤
- æŒ‰æœ€åæ›´æ–°æ—¶é—´é™åºæ’åˆ—
- è‡ªåŠ¨æ•°æ®éªŒè¯å’Œé™çº§å¤„ç†
- ç©ºæ•°æ®çš„å®‰å…¨å¤„ç†

### è·å–å•ä¸ªå·¥ä½œæµ (getFlow)

`getFlow`æ–¹æ³•æä¾›ç²¾ç¡®çš„å·¥ä½œæµæŸ¥è¯¢åŠŸèƒ½ï¼š

```mermaid
flowchart TD
Start([å¼€å§‹è·å–å·¥ä½œæµ]) --> QueryDB["æŸ¥è¯¢Supabase flowsè¡¨"]
QueryDB --> CheckError{"æ˜¯å¦æœ‰é”™è¯¯?"}
CheckError --> |æ˜¯| LogError["è®°å½•é”™è¯¯æ—¥å¿—"]
CheckError --> |å¦| CheckData{"æ˜¯å¦æœ‰æ•°æ®?"}
CheckData --> |å¦| ReturnNull["è¿”å›null"]
CheckData --> |æ˜¯| ValidateData["éªŒè¯æ•°æ®ç»“æ„"]
ValidateData --> BuildResponse["æ„å»ºå“åº”å¯¹è±¡"]
BuildResponse --> End([è¿”å›FlowRecord])
LogError --> ReturnNull
```

**å›¾è¡¨æ¥æº**
- [flowAPI.ts](file://src/services/flowAPI.ts#L75-L102)

### åˆ›å»ºå·¥ä½œæµ (createFlow)

`createFlow`æ–¹æ³•å®ç°äº†å·¥ä½œæµçš„åˆ›å»ºé€»è¾‘ï¼š

**å‚æ•°è¯´æ˜ï¼š**
- `name`: å·¥ä½œæµåç§°ï¼ˆå¿…å¡«ï¼‰
- `flowData`: å·¥ä½œæµæ•°æ®ç»“æ„ï¼ˆå¿…å¡«ï¼‰
- `ownerId`: æ‰€æœ‰è€…IDï¼ˆé»˜è®¤ä¸º"anonymous"ï¼‰
- `description`: å·¥ä½œæµæè¿°ï¼ˆå¯é€‰ï¼‰

**è¿”å›å€¼ï¼š** è¿”å›å®Œæ•´çš„FlowRecordå¯¹è±¡

### æ›´æ–°å·¥ä½œæµ (updateFlow)

`updateFlow`æ–¹æ³•æ”¯æŒéƒ¨åˆ†å­—æ®µæ›´æ–°ï¼š

**æ”¯æŒæ›´æ–°çš„å­—æ®µï¼š**
- `name`: å·¥ä½œæµåç§°
- `description`: å·¥ä½œæµæè¿°
- `data`: å·¥ä½œæµæ•°æ®
- `icon_kind`: å›¾æ ‡ç±»å‹ï¼ˆemoji/lucide/imageï¼‰
- `icon_name`: å›¾æ ‡åç§°
- `icon_url`: å›¾æ ‡URL

**ç« èŠ‚æ¥æº**
- [flowAPI.ts](file://src/services/flowAPI.ts#L14-L239)

### è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ (autoSave)

è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ç»“åˆäº†é˜²æŠ–ä¼˜åŒ–å’Œæ™ºèƒ½åˆ¤æ–­é€»è¾‘ï¼š

```mermaid
sequenceDiagram
participant Store as flowStore
participant Timer as å®šæ—¶å™¨
participant API as flowAPI
participant DB as Supabase
Store->>Timer : è®¾ç½®800mså®šæ—¶å™¨
Store->>Store : æ›´æ–°saveStatusä¸º"saving"
Timer->>Timer : ç­‰å¾…800ms
Timer->>API : autoSave(flowId, name, data)
API->>API : åˆ¤æ–­æ˜¯å¦ä¸ºæ–°å·¥ä½œæµ
alt flowIdå­˜åœ¨
API->>DB : updateFlow(flowId, updates)
else flowIdä¸å­˜åœ¨
API->>DB : createFlow(name, data)
end
DB-->>API : è¿”å›ç»“æœ
API-->>Store : è¿”å›flowId
Store->>Store : æ›´æ–°saveStatusä¸º"saved"
```

**å›¾è¡¨æ¥æº**
- [flowStore.ts](file://src/store/flowStore.ts#L50-L75)
- [flowAPI.ts](file://src/services/flowAPI.ts#L211-L225)

**é˜²æŠ–ä¼˜åŒ–ç­–ç•¥ï¼š**
- å»¶è¿Ÿ800æ¯«ç§’æ‰§è¡Œä¿å­˜æ“ä½œ
- åœ¨å»¶è¿ŸæœŸé—´æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
- åªä¿å­˜æœ€æ–°çš„çŠ¶æ€å˜æ›´

### å·¥ä½œæµå¤åˆ¶ (duplicateFlow)

`duplicateFlow`æ–¹æ³•æä¾›äº†å·¥ä½œæµå¤åˆ¶åŠŸèƒ½ï¼š

**å®ç°æ­¥éª¤ï¼š**
1. è·å–æºå·¥ä½œæµæ•°æ®
2. ç”Ÿæˆå‰¯æœ¬åç§°ï¼ˆæ·»åŠ " Copy"åç¼€ï¼‰
3. åˆ›å»ºæ–°çš„å·¥ä½œæµ
4. åŒæ­¥å›¾æ ‡è®¾ç½®
5. è¿”å›å®Œæ•´çš„å‰¯æœ¬è®°å½•

**ç« èŠ‚æ¥æº**
- [flowAPI.ts](file://src/services/flowAPI.ts#L227-L238)

## çŠ¶æ€åŒæ­¥æœºåˆ¶

### flowStoreä¸flowAPIçš„åä½œ

ç³»ç»Ÿé€šè¿‡flowStoreç®¡ç†åº”ç”¨çŠ¶æ€ï¼Œå¹¶ä¸flowAPIä¿æŒæ•°æ®åŒæ­¥ï¼š

```mermaid
graph LR
subgraph "ç”¨æˆ·äº¤äº’"
A[æ‹–æ‹½èŠ‚ç‚¹] --> B[ä¿®æ”¹è¾¹è¿æ¥]
C[ç¼–è¾‘æ ‡é¢˜] --> D[æ›´æ”¹å›¾æ ‡]
end
subgraph "flowStoreçŠ¶æ€ç®¡ç†"
E[setFlowTitle] --> F[scheduleSave]
G[setNodes] --> F
H[setEdges] --> F
end
subgraph "è‡ªåŠ¨ä¿å­˜æµç¨‹"
F --> I[é˜²æŠ–å¤„ç†]
I --> J[æ”¶é›†å½“å‰çŠ¶æ€]
J --> K[flowAPI.autoSave]
K --> L[æ›´æ–°currentFlowId]
end
A --> E
B --> G
C --> E
D --> M[setFlowIcon]
M --> F
L --> N[UIçŠ¶æ€æ›´æ–°]
```

**å›¾è¡¨æ¥æº**
- [flowStore.ts](file://src/store/flowStore.ts#L34-L75)

### çŠ¶æ€åŒæ­¥çš„å…³é”®æœºåˆ¶

1. **å®æ—¶çŠ¶æ€è¿½è¸ª**: flowStoreæŒç»­ç›‘æ§çŠ¶æ€å˜åŒ–
2. **æ™ºèƒ½é˜²æŠ–**: 800mså»¶è¿Ÿé¿å…é¢‘ç¹ä¿å­˜
3. **çŠ¶æ€ä¸€è‡´æ€§**: ç¡®ä¿UIçŠ¶æ€ä¸æ•°æ®åº“çŠ¶æ€åŒæ­¥
4. **é”™è¯¯æ¢å¤**: ä¿å­˜å¤±è´¥æ—¶ä¿æŒæœ¬åœ°çŠ¶æ€ä¸å˜

**ç« èŠ‚æ¥æº**
- [flowStore.ts](file://src/store/flowStore.ts#L1-L131)

## é”™è¯¯å¤„ç†ä¸é™çº§ç­–ç•¥

### æ•°æ®éªŒè¯æœºåˆ¶

ç³»ç»Ÿå®ç°äº†å¤šå±‚æ¬¡çš„æ•°æ®éªŒè¯ï¼š

```mermaid
flowchart TD
Start([æ¥æ”¶æ•°æ®]) --> ParseData["è§£æJSONæ•°æ®"]
ParseData --> CheckType{"æ•°æ®ç±»å‹æ£€æŸ¥"}
CheckType --> |éå¯¹è±¡| DegradedMode["é™çº§æ¨¡å¼"]
CheckType --> |å¯¹è±¡| ValidateFields["éªŒè¯å¿…éœ€å­—æ®µ"]
ValidateFields --> CheckNodes{"nodeså­—æ®µæ£€æŸ¥"}
CheckNodes --> |ç¼ºå¤±| SetEmptyNodes["è®¾ç½®ç©ºnodesæ•°ç»„"]
CheckNodes --> |å­˜åœ¨| CheckEdges{"edgeså­—æ®µæ£€æŸ¥"}
CheckEdges --> |ç¼ºå¤±| SetEmptyEdges["è®¾ç½®ç©ºedgesæ•°ç»„"]
CheckEdges --> |å­˜åœ¨| Success["éªŒè¯æˆåŠŸ"]
SetEmptyNodes --> Success
SetEmptyEdges --> Success
DegradedMode --> LogError["è®°å½•é”™è¯¯æ—¥å¿—"]
LogError --> ReturnDefault["è¿”å›é»˜è®¤ç»“æ„"]
Success --> ReturnData["è¿”å›æœ‰æ•ˆæ•°æ®"]
```

**å›¾è¡¨æ¥æº**
- [flowAPI.ts](file://src/services/flowAPI.ts#L36-L54)

### é™çº§å¤„ç†ç­–ç•¥

å½“é‡åˆ°æŸåæ•°æ®æ—¶ï¼Œç³»ç»Ÿé‡‡ç”¨ä»¥ä¸‹é™çº§ç­–ç•¥ï¼š

| åœºæ™¯ | å¤„ç†æ–¹å¼ | ç»“æœ |
|------|----------|------|
| æ— æ•ˆçš„JSONæ ¼å¼ | è¿”å›ç©ºèŠ‚ç‚¹å’Œè¾¹ | `{nodes: [], edges: []}` |
| ç¼ºå¤±å¿…éœ€å­—æ®µ | ä½¿ç”¨é»˜è®¤å€¼ | ä¿ç•™å…¶ä»–æœ‰æ•ˆå­—æ®µ |
| æ•°æ®ç±»å‹é”™è¯¯ | å¼ºåˆ¶ç±»å‹è½¬æ¢ | å°è¯•ä¿®å¤æ•°æ®ç±»å‹ |
| ç½‘ç»œè¯·æ±‚å¤±è´¥ | æ˜¾ç¤ºé”™è¯¯æç¤º | ä¿æŒæœ¬åœ°çŠ¶æ€ |

### é”™è¯¯æ¢å¤æœºåˆ¶

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant UI as ç”¨æˆ·ç•Œé¢
participant Store as flowStore
participant API as flowAPI
participant Server as SupabaseæœåŠ¡å™¨
User->>UI : æ‰§è¡Œæ“ä½œ
UI->>Store : è§¦å‘çŠ¶æ€æ›´æ–°
Store->>API : è°ƒç”¨APIæ–¹æ³•
API->>Server : å‘é€è¯·æ±‚
Server-->>API : è¿”å›é”™è¯¯
API->>API : è®°å½•é”™è¯¯æ—¥å¿—
API-->>Store : æŠ›å‡ºå¼‚å¸¸
Store->>Store : æ¢å¤åˆ°ä¹‹å‰çŠ¶æ€
Store->>UI : æ›´æ–°é”™è¯¯çŠ¶æ€
UI->>User : æ˜¾ç¤ºé”™è¯¯æç¤º
```

**å›¾è¡¨æ¥æº**
- [flowStore.ts](file://src/store/flowStore.ts#L69-L73)

**ç« èŠ‚æ¥æº**
- [flowAPI.ts](file://src/services/flowAPI.ts#L36-L69)

## æ€§èƒ½ä¼˜åŒ–

### é˜²æŠ–ä¼˜åŒ–ç­–ç•¥

è‡ªåŠ¨ä¿å­˜åŠŸèƒ½é‡‡ç”¨é˜²æŠ–æŠ€æœ¯é¿å…é¢‘ç¹çš„æ•°æ®åº“å†™å…¥ï¼š

**ä¼˜åŒ–æ•ˆæœï¼š**
- å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ï¼šæœ€å¤šå‡å°‘90%
- é™ä½æ•°æ®åº“è´Ÿè½½ï¼šæ˜¾è‘—æå‡ç³»ç»Ÿå“åº”æ€§
- æå‡ç”¨æˆ·ä½“éªŒï¼šé¿å…ç•Œé¢å¡é¡¿

### æ•°æ®ç¼“å­˜ç­–ç•¥

ç³»ç»Ÿåœ¨å¤šä¸ªå±‚é¢å®æ–½ç¼“å­˜ä¼˜åŒ–ï¼š

1. **æµè§ˆå™¨ç¼“å­˜**: åˆ©ç”¨HTTPç¼“å­˜æœºåˆ¶
2. **å†…å­˜ç¼“å­˜**: flowStoreç»´æŠ¤æœ€æ–°çŠ¶æ€
3. **æ•°æ®åº“ç´¢å¼•**: Supabaseè‡ªåŠ¨ä¼˜åŒ–æŸ¥è¯¢

### æ‰¹é‡æ“ä½œä¼˜åŒ–

å¯¹äºå¤§é‡æ•°æ®çš„æ“ä½œï¼Œç³»ç»Ÿé‡‡ç”¨æ‰¹é‡å¤„ç†ç­–ç•¥ï¼š

```mermaid
graph TB
subgraph "æ‰¹é‡æ“ä½œä¼˜åŒ–"
A[æ£€æµ‹æ‰¹é‡æ“ä½œ] --> B[åˆå¹¶ç›¸ä¼¼è¯·æ±‚]
B --> C[å‡å°‘ç½‘ç»œå¾€è¿”]
C --> D[æå‡æ•´ä½“æ€§èƒ½]
end
subgraph "å…·ä½“å®ç°"
E[èŠ‚ç‚¹æ‰¹é‡æ·»åŠ ] --> F[è¾¹æ‰¹é‡è¿æ¥]
F --> G[çŠ¶æ€æ‰¹é‡æ›´æ–°]
end
A --> E
```

## ä½¿ç”¨ç¤ºä¾‹

### åœ¨Flowsé¡µé¢ä¸­çš„ä½¿ç”¨

åœ¨æµç¨‹åˆ—è¡¨é¡µé¢ä¸­ï¼ŒflowAPIä¸»è¦ç”¨äºåŠ è½½å’Œç®¡ç†å·¥ä½œæµï¼š

**åŸºæœ¬ä½¿ç”¨æ¨¡å¼ï¼š**
```typescript
// åŠ è½½æ‰€æœ‰å·¥ä½œæµ
const flows = await flowAPI.listFlows();

// åˆ›å»ºæ–°å·¥ä½œæµ
const newFlow = await flowAPI.createFlow(
    "æˆ‘çš„å·¥ä½œæµ",
    { nodes: [], edges: [] },
    "user123",
    "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å·¥ä½œæµ"
);

// åˆ é™¤å·¥ä½œæµ
await flowAPI.deleteFlow(flowId);
```

**ç« èŠ‚æ¥æº**
- [page.tsx](file://src/app/flows/page.tsx#L23-L50)

### åœ¨Builderé¡µé¢ä¸­çš„ä½¿ç”¨

åœ¨æ„å»ºå™¨é¡µé¢ä¸­ï¼ŒflowAPIä¸flowStoreååŒå·¥ä½œï¼š

**è‡ªåŠ¨ä¿å­˜é›†æˆï¼š**
```typescript
// è®¾ç½®å·¥ä½œæµæ ‡é¢˜è§¦å‘è‡ªåŠ¨ä¿å­˜
setFlowTitle("æˆ‘çš„AIå·¥ä½œæµ");

// èŠ‚ç‚¹çŠ¶æ€å˜æ›´è§¦å‘ä¿å­˜
setNodes(updatedNodes);

// è¾¹è¿æ¥å˜æ›´è§¦å‘ä¿å­˜  
setEdges(updatedEdges);
```

**ç« èŠ‚æ¥æº**
- [page.tsx](file://src/app/builder/[id]/page.tsx#L12-L13)

### åœ¨FlowCardç»„ä»¶ä¸­çš„ä½¿ç”¨

FlowCardç»„ä»¶å±•ç¤ºäº†å·¥ä½œæµçš„å„ç§æ“ä½œï¼š

**å·¥ä½œæµæ“ä½œç¤ºä¾‹ï¼š**
```typescript
// å¤åˆ¶å·¥ä½œæµ
const copy = await flowAPI.duplicateFlow(flowId);

// æ›´æ–°å·¥ä½œæµåŸºæœ¬ä¿¡æ¯
const updated = await flowAPI.updateFlow(flowId, { 
    name: newName, 
    description: newDesc 
});

// æ›´æ”¹å·¥ä½œæµå›¾æ ‡
const updated = await flowAPI.updateFlow(flowId, {
    icon_kind: "emoji",
    icon_name: "ğŸ¤–",
    icon_url: null
});
```

**ç« èŠ‚æ¥æº**
- [FlowCard.tsx](file://src/components/flows/FlowCard.tsx#L37-L75)

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

| é—®é¢˜ç±»å‹ | ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|----------|
| åŠ è½½å¤±è´¥ | å·¥ä½œæµåˆ—è¡¨ä¸ºç©º | ç½‘ç»œè¿æ¥é—®é¢˜ | æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œåˆ·æ–°é¡µé¢ |
| ä¿å­˜å¤±è´¥ | è‡ªåŠ¨ä¿å­˜çŠ¶æ€æŒç»­æ˜¾ç¤º"æ­£åœ¨ä¿å­˜..." | æ•°æ®éªŒè¯å¤±è´¥ | æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼Œé‡ç½®å·¥ä½œæµ |
| å¤åˆ¶å¤±è´¥ | å¤åˆ¶æŒ‰é’®æ— å“åº” | æºå·¥ä½œæµä¸å­˜åœ¨ | ç¡®è®¤æºå·¥ä½œæµIDæ­£ç¡® |
| å›¾æ ‡ä¸Šä¼ å¤±è´¥ | å›¾æ ‡æ›´æ¢ä¸ç”Ÿæ•ˆ | Storage Bucketé…ç½®é”™è¯¯ | æ£€æŸ¥Supabaseå­˜å‚¨æ¡¶æƒé™ |

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**: åœ¨å¼€å‘ç¯å¢ƒä¸­æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. **æ£€æŸ¥ç½‘ç»œè¯·æ±‚**: ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ç›‘æ§APIè°ƒç”¨
3. **éªŒè¯æ•°æ®ç»“æ„**: ç¡®ä¿ä¼ é€’ç»™APIçš„æ•°æ®ç¬¦åˆç±»å‹å®šä¹‰
4. **æµ‹è¯•è¾¹ç•Œæƒ…å†µ**: éªŒè¯ç©ºæ•°æ®ã€å¤§å®¹é‡æ•°æ®çš„å¤„ç†

### æ€§èƒ½ç›‘æ§

**å…³é”®æŒ‡æ ‡ç›‘æ§ï¼š**
- APIå“åº”æ—¶é—´ï¼š< 500ms
- è‡ªåŠ¨ä¿å­˜æˆåŠŸç‡ï¼š> 95%
- æ•°æ®éªŒè¯é€šè¿‡ç‡ï¼š> 99%
- é”™è¯¯æ¢å¤æ—¶é—´ï¼š< 2ç§’

**ç« èŠ‚æ¥æº**
- [flowStore.ts](file://src/store/flowStore.ts#L69-L73)
- [flowAPI.ts](file://src/services/flowAPI.ts#L202-L205)

## æ€»ç»“

FlowAPIæœåŠ¡ä½œä¸ºFlash Flow SaaSå¹³å°çš„æ ¸å¿ƒæ•°æ®å±‚ï¼Œæä¾›äº†å®Œæ•´è€Œå¯é çš„å·¥ä½œæµç®¡ç†åŠŸèƒ½ã€‚é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æ¶æ„å’Œå¤šé‡ä¿éšœæœºåˆ¶ï¼Œç¡®ä¿äº†æ•°æ®çš„å®Œæ•´æ€§å’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
1. **å®Œæ•´çš„CRUDæ”¯æŒ**: æ¶µç›–å·¥ä½œæµç”Ÿå‘½å‘¨æœŸçš„æ‰€æœ‰æ“ä½œ
2. **æ™ºèƒ½æ•°æ®éªŒè¯**: å¤šå±‚æ¬¡çš„æ•°æ®éªŒè¯å’Œé™çº§å¤„ç†
3. **é«˜æ•ˆçš„è‡ªåŠ¨ä¿å­˜**: é˜²æŠ–ä¼˜åŒ–å’ŒçŠ¶æ€åŒæ­¥æœºåˆ¶
4. **å¼ºå¤§çš„é”™è¯¯å¤„ç†**: å…¨é¢çš„é”™è¯¯æ•è·å’Œæ¢å¤ç­–ç•¥
5. **ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ**: æµç•…çš„äº¤äº’å’ŒåŠæ—¶çš„çŠ¶æ€åé¦ˆ

**æŠ€æœ¯ç‰¹è‰²ï¼š**
- åŸºäºTypeScriptçš„å¼ºç±»å‹ç³»ç»Ÿ
- å“åº”å¼çš„çŠ¶æ€ç®¡ç†æ¨¡å¼
- å¯é çš„Supabaseæ•°æ®å±‚é›†æˆ
- æ¨¡å—åŒ–çš„ç»„ä»¶è®¾è®¡

é€šè¿‡è¿™å¥—å®Œæ•´çš„æ•°æ®æŒä¹…åŒ–è§£å†³æ–¹æ¡ˆï¼Œç”¨æˆ·å¯ä»¥å®‰å…¨ã€é«˜æ•ˆåœ°åˆ›å»ºã€ç®¡ç†å’Œå…±äº«AIå·¥ä½œæµï¼Œä¸ºæ„å»ºæ™ºèƒ½åŒ–åº”ç”¨æä¾›äº†åšå®çš„åŸºç¡€æ”¯æ’‘ã€‚