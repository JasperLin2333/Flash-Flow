# Plan ç”Ÿæˆä¼˜åŒ–è·¯å¾„è§„åˆ’ä»»åŠ¡ä¹¦

> **ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-01  
> **ç›®æ ‡**: æå‡ Flow ç”Ÿæˆçš„é€Ÿåº¦ã€å‡†ç¡®åº¦ã€å¤æ‚åº¦å’Œä¸šåŠ¡ç†è§£èƒ½åŠ›

---

## æ€»è§ˆ

| é˜¶æ®µ | åç§° | é¢„ä¼°è€—æ—¶ | ä¼˜å…ˆçº§ |
|-----|------|---------|-------|
| Phase 1 | Prompt è§„åˆ™ä¼˜åŒ– | 2 å¤© | ğŸ”´ é«˜ |
| Phase 2 | Few-shot ç¤ºä¾‹åº“ | 3 å¤© | ğŸ”´ é«˜ |
| Phase 3 | ä¸¤é˜¶æ®µç”Ÿæˆæ¶æ„ | 4 å¤© | ğŸŸ¡ ä¸­ |
| Phase 4 | åŒæ­¥æ£€æŸ¥æœºåˆ¶ | 1 å¤© | ğŸŸ¢ ä½ |
| Phase 5 | è¯„ä¼°åŸºå‡†å»ºç«‹ | 2 å¤© | ğŸŸ¢ ä½ |

**æ€»é¢„ä¼°**: 12 å·¥ä½œæ—¥

---

## Phase 1: Prompt è§„åˆ™ä¼˜åŒ–

### 1.1 ä¸šåŠ¡é€»è¾‘æ·±åº¦è§„åˆ™

**ç›®æ ‡æ–‡ä»¶**: `src/lib/prompts/smartRules.ts`

**ä»»åŠ¡**:
- [ ] æ·»åŠ  LLM SystemPrompt è´¨é‡é“å¾‹
- [ ] ç¦æ­¢ç©ºæ´å†…å®¹æ¨¡å¼åˆ—è¡¨
- [ ] å¿…é¡»åŒ…å«è¦ç´ æ£€æŸ¥æ¸…å•

**å…·ä½“å†…å®¹**:

```markdown
## LLM SystemPrompt è´¨é‡é“å¾‹

âŒ **ç¦æ­¢ç©ºæ´å†…å®¹**ï¼š
- "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹"
- "è¯·å¸®åŠ©ç”¨æˆ·å®Œæˆä»»åŠ¡"  
- "ä½ æ˜¯AIåŠ©æ‰‹ï¼Œå¯ä»¥å›ç­”å„ç§é—®é¢˜"

âœ… **å¿…é¡»åŒ…å«**ï¼š
1. **è§’è‰²å®šä½**: ä½ æ˜¯[å…·ä½“é¢†åŸŸ]çš„ä¸“å®¶ï¼Œæ“…é•¿[å…·ä½“æŠ€èƒ½]
2. **ä»»åŠ¡ç›®æ ‡**: å®Œæˆ[å…·ä½“ä»»åŠ¡]ï¼Œè¾“å‡º[å…·ä½“æ ¼å¼]
3. **çº¦æŸæ¡ä»¶**: å¿…é¡»éµå¾ª[å…·ä½“è§„åˆ™]ï¼Œç¦æ­¢[å…·ä½“è¡Œä¸º]
4. **è¾“å‡ºæ ¼å¼**: ç¤ºä¾‹ { "field": "value" } (å¦‚éœ€JSON)

âœ… **å¥½çš„ç¤ºä¾‹**ï¼š
"ä½ æ˜¯ä¸“ä¸šçš„å°çº¢ä¹¦æ–‡æ¡ˆç­–åˆ’å¸ˆï¼Œæ“…é•¿å°†äº§å“å–ç‚¹è½¬åŒ–ä¸ºç§è‰æ–‡æ¡ˆã€‚
ä»»åŠ¡ï¼šåŸºäºç”¨æˆ·æä¾›çš„äº§å“ä¿¡æ¯ï¼Œç”Ÿæˆ3æ¡ä¸åŒé£æ ¼çš„å°çº¢ä¹¦ç¬”è®°ã€‚
çº¦æŸï¼šæ¯æ¡200-300å­—ï¼Œå¿…é¡»åŒ…å«emojiï¼Œä½¿ç”¨å£è¯­åŒ–è¡¨è¾¾ã€‚
æ ¼å¼ï¼šåˆ†ä¸‰æ®µè¾“å‡ºï¼Œæ¯æ®µæ ‡æ³¨ã€é£æ ¼ã€‘æ ‡ç­¾ã€‚"
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] è§„åˆ™æ–‡æ¡£å®Œæˆ
- [ ] é›†æˆåˆ° system prompt
- [ ] æµ‹è¯• 5 ä¸ªåœºæ™¯éªŒè¯æ•ˆæœ

---

### 1.2 æ„å›¾æ¨ç†é“¾ (Chain of Thought)

**ç›®æ ‡æ–‡ä»¶**: `src/lib/prompts/scenarioRules.ts`

**ä»»åŠ¡**:
- [ ] æ·»åŠ æ„å›¾æ¨ç†é“¾æ¨¡æ¿
- [ ] åœ¨ç”Ÿæˆå‰å¼ºåˆ¶å›ç­”å…³é”®é—®é¢˜

**å…·ä½“å†…å®¹**:

```markdown
## æ„å›¾æ¨ç†é“¾ (ç”Ÿæˆå‰å¿…é¡»å›ç­”)

åœ¨ç”Ÿæˆå·¥ä½œæµ JSON å‰ï¼Œå…ˆåˆ†æä»¥ä¸‹é—®é¢˜ï¼š

1. **æ ¸å¿ƒéœ€æ±‚**: ç”¨æˆ·æƒ³è¦å®Œæˆä»€ä¹ˆï¼Ÿ(ä¸€å¥è¯)
2. **æ•°æ®æ¥æº**: 
   - ç”¨æˆ·è¾“å…¥æ–‡æœ¬ï¼Ÿâ†’ enableTextInput
   - ä¸Šä¼ æ–‡ä»¶ï¼Ÿâ†’ enableFileInput + RAG
   - ç»“æ„åŒ–é€‰é¡¹ï¼Ÿâ†’ enableStructuredForm
3. **å¤„ç†èƒ½åŠ›**:
   - å†…å®¹ç”Ÿæˆï¼Ÿâ†’ LLM
   - æ–‡æ¡£æ£€ç´¢ï¼Ÿâ†’ RAG
   - å›¾ç‰‡ç”Ÿæˆï¼Ÿâ†’ ImageGen
   - è”ç½‘æœç´¢ï¼Ÿâ†’ Tool(web_search)
   - æ—¶é—´ç›¸å…³ï¼Ÿâ†’ Tool(datetime)
4. **åˆ†æ”¯é€»è¾‘**: 
   - æ˜¯å¦æœ‰æ¡ä»¶åˆ¤æ–­ï¼Ÿâ†’ Branch
   - å¤šæ¡è·¯å¾„ï¼Ÿâ†’ Output(select)
5. **è®°å¿†éœ€æ±‚**:
   - å¤šè½®å¯¹è¯ï¼Ÿâ†’ enableMemory: true
   - å•æ¬¡ä»»åŠ¡ï¼Ÿâ†’ enableMemory: false
6. **è¾“å‡ºå½¢å¼**:
   - çº¯æ–‡æœ¬ï¼Ÿâ†’ Output(direct)
   - é™„å¸¦æ–‡ä»¶ï¼Ÿâ†’ Output + attachments
   - æ ¼å¼åŒ–æŠ¥å‘Šï¼Ÿâ†’ Output(template)
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ¨ç†é“¾æ¨¡æ¿å®Œæˆ
- [ ] é›†æˆåˆ° system prompt
- [ ] æµ‹è¯•å¤æ‚æ„å›¾è¯†åˆ«å‡†ç¡®ç‡

---

## Phase 2: Few-shot ç¤ºä¾‹åº“

### 2.1 ç¤ºä¾‹åº“ç»“æ„è®¾è®¡

**ç›®æ ‡æ–‡ä»¶**: `src/lib/prompts/examples/` (æ–°ç›®å½•)

**æ–‡ä»¶ç»“æ„**:
```
src/lib/prompts/examples/
â”œâ”€â”€ index.ts           # å¯¼å‡ºå’ŒåŠ¨æ€é€‰æ‹©é€»è¾‘
â”œâ”€â”€ simple.ts          # ç®€å•åœºæ™¯ (3èŠ‚ç‚¹)
â”œâ”€â”€ medium.ts          # ä¸­ç­‰åœºæ™¯ (5-7èŠ‚ç‚¹)
â””â”€â”€ complex.ts         # å¤æ‚åœºæ™¯ (8+èŠ‚ç‚¹)
```

**ä»»åŠ¡**:
- [ ] åˆ›å»ºç›®å½•ç»“æ„
- [ ] å®ç°ç¤ºä¾‹é€‰æ‹©é€»è¾‘
- [ ] ç¼–å†™ 15-20 ä¸ªé«˜è´¨é‡ç¤ºä¾‹

---

### 2.2 ç¤ºä¾‹å†…å®¹è§„åˆ’

**ç®€å•åœºæ™¯ (5 ä¸ª)**:

| åºå· | åœºæ™¯åç§° | èŠ‚ç‚¹æ•° | èŠ‚ç‚¹ç»„åˆ |
|-----|---------|-------|---------|
| S1 | ç¿»è¯‘åŠ©æ‰‹ | 3 | Input â†’ LLM â†’ Output |
| S2 | æ–‡æ¡ˆæ¶¦è‰² | 3 | Input â†’ LLM â†’ Output |
| S3 | æ‘˜è¦ç”Ÿæˆ | 3 | Input â†’ LLM â†’ Output |
| S4 | ç®€å•é—®ç­” | 3 | Input â†’ LLM(memory) â†’ Output |
| S5 | æƒ…æ„Ÿåˆ†æ | 3 | Input â†’ LLM(json) â†’ Output |

**ä»»åŠ¡**:
- [ ] S1 ç¿»è¯‘åŠ©æ‰‹ç¤ºä¾‹
- [ ] S2 æ–‡æ¡ˆæ¶¦è‰²ç¤ºä¾‹
- [ ] S3 æ‘˜è¦ç”Ÿæˆç¤ºä¾‹
- [ ] S4 ç®€å•é—®ç­”ç¤ºä¾‹
- [ ] S5 æƒ…æ„Ÿåˆ†æç¤ºä¾‹

---

**ä¸­ç­‰åœºæ™¯ (7 ä¸ª)**:

| åºå· | åœºæ™¯åç§° | èŠ‚ç‚¹æ•° | èŠ‚ç‚¹ç»„åˆ |
|-----|---------|-------|---------|
| M1 | æ–‡æ¡£é—®ç­” | 5 | Input(file) â†’ RAG â†’ LLM â†’ Output |
| M2 | è”ç½‘æœç´¢åŠ©æ‰‹ | 5 | Input â†’ Tool(search) â†’ LLM â†’ Output |
| M3 | å›¾ç‰‡åˆ†æ | 5 | Input(img) â†’ RAG â†’ LLM â†’ Output |
| M4 | å®æ—¶æ•°æ®åˆ†æ | 6 | Input â†’ Tool(datetime) â†’ Tool(search) â†’ LLM â†’ Output |
| M5 | æ™ºèƒ½å®¢æœ | 5 | Input â†’ RAG â†’ LLM(memory) â†’ Output |
| M6 | æ–‡ç”Ÿå›¾æµç¨‹ | 5 | Input(form) â†’ LLM â†’ ImageGen â†’ Output |
| M7 | ç½‘é¡µæ‘˜è¦ | 5 | Input â†’ Tool(url_reader) â†’ LLM â†’ Output |

**ä»»åŠ¡**:
- [ ] M1 æ–‡æ¡£é—®ç­”ç¤ºä¾‹
- [ ] M2 è”ç½‘æœç´¢ç¤ºä¾‹
- [ ] M3 å›¾ç‰‡åˆ†æç¤ºä¾‹
- [ ] M4 å®æ—¶æ•°æ®ç¤ºä¾‹
- [ ] M5 æ™ºèƒ½å®¢æœç¤ºä¾‹
- [ ] M6 æ–‡ç”Ÿå›¾ç¤ºä¾‹
- [ ] M7 ç½‘é¡µæ‘˜è¦ç¤ºä¾‹

---

**å¤æ‚åœºæ™¯ (5 ä¸ª)**:

| åºå· | åœºæ™¯åç§° | èŠ‚ç‚¹æ•° | èŠ‚ç‚¹ç»„åˆ |
|-----|---------|-------|---------|
| C1 | æŠ•èµ„é¡¾é—® (åˆ†æ”¯) | 8 | Input(form) â†’ Branch â†’ [Tool + LLM] Ã— 2 â†’ Output(select) |
| C2 | æ–‡æ¡£åˆ†ææŠ¥å‘Š | 7 | Input(file) â†’ RAG â†’ LLM(åˆ†æ) â†’ LLM(ç»“è®º) â†’ Output(merge) |
| C3 | æ•°æ®å¯è§†åŒ– | 7 | Input(file) â†’ RAG â†’ LLM â†’ Tool(code) â†’ Output(é™„ä»¶) |
| C4 | å¤šè½®å®¡æ‰¹ | 9 | Input â†’ Branch â†’ [LLM] Ã— 3 â†’ Output |
| C5 | æ™ºèƒ½å†…å®¹åˆ›ä½œ | 8 | Input(form) â†’ Tool(search) â†’ LLM(å¤§çº²) â†’ LLM(æ­£æ–‡) â†’ ImageGen â†’ Output |

**ä»»åŠ¡**:
- [ ] C1 æŠ•èµ„é¡¾é—®ç¤ºä¾‹
- [ ] C2 æŠ¥å‘Šç”Ÿæˆç¤ºä¾‹
- [ ] C3 æ•°æ®å¯è§†åŒ–ç¤ºä¾‹
- [ ] C4 å®¡æ‰¹æµç¨‹ç¤ºä¾‹
- [ ] C5 å†…å®¹åˆ›ä½œç¤ºä¾‹

---

### 2.3 ç¤ºä¾‹é€‰æ‹©é€»è¾‘

**ç›®æ ‡æ–‡ä»¶**: `src/lib/prompts/examples/index.ts`

```typescript
// æ ¹æ®ç”¨æˆ·è¾“å…¥å¤æ‚åº¦é€‰æ‹©ç›¸å…³ç¤ºä¾‹
export function selectExamples(userInput: string): string[] {
  const complexity = analyzeComplexity(userInput);
  
  // æ€»æ˜¯åŒ…å« 1 ä¸ªå¯¹åº”å¤æ‚åº¦çš„ç¤ºä¾‹
  // å¦‚æœè¯†åˆ«åˆ°ç‰¹å®šåœºæ™¯ï¼Œé¢å¤–åŠ å…¥ç›¸å…³ç¤ºä¾‹
  
  const examples: string[] = [];
  
  // å¤æ‚åº¦åŒ¹é…
  if (complexity === 'simple') {
    examples.push(getRandomExample('simple'));
  } else if (complexity === 'medium') {
    examples.push(getRandomExample('medium'));
  } else {
    examples.push(getRandomExample('complex'));
  }
  
  // å…³é”®è¯åŒ¹é… (æœ€å¤šè¡¥å…… 1 ä¸ª)
  if (containsKeywords(userInput, ['æ–‡ä»¶', 'æ–‡æ¡£', 'PDF', 'ä¸Šä¼ '])) {
    examples.push(EXAMPLES.M1); // æ–‡æ¡£é—®ç­”
  } else if (containsKeywords(userInput, ['æœç´¢', 'è”ç½‘', 'æœ€æ–°'])) {
    examples.push(EXAMPLES.M2); // è”ç½‘æœç´¢
  } else if (containsKeywords(userInput, ['åˆ†æ”¯', 'åˆ¤æ–­', 'æ¡ä»¶'])) {
    examples.push(EXAMPLES.C1); // åˆ†æ”¯ç¤ºä¾‹
  }
  
  return examples.slice(0, 2); // æœ€å¤š 2 ä¸ªç¤ºä¾‹
}
```

**ä»»åŠ¡**:
- [ ] å®ç° `analyzeComplexity` å‡½æ•°
- [ ] å®ç° `containsKeywords` å‡½æ•°
- [ ] å®ç° `selectExamples` å‡½æ•°
- [ ] é›†æˆåˆ° `plan/route.ts`

---

## Phase 3: ä¸¤é˜¶æ®µç”Ÿæˆæ¶æ„

### 3.1 é˜¶æ®µä¸€ï¼šéª¨æ¶ç”Ÿæˆ

**ç›®æ ‡æ–‡ä»¶**: `src/app/api/plan/route.ts` (é‡æ„)

**è¾“å…¥**: ç”¨æˆ·æè¿°
**è¾“å‡º**:
```typescript
interface FlowSkeleton {
  intent: string;           // "åˆ›å»ºä¸€ä¸ªæ–‡æ¡£é—®ç­”åŠ©æ‰‹"
  complexity: 'simple' | 'medium' | 'complex';
  nodeSequence: string[];   // ["input", "rag", "llm", "output"]
  hasFileUpload: boolean;
  hasMemory: boolean;
  hasBranch: boolean;
}
```

**ä»»åŠ¡**:
- [ ] è®¾è®¡éª¨æ¶ç”Ÿæˆ prompt
- [ ] å®ç°éª¨æ¶è§£æé€»è¾‘
- [ ] æ·»åŠ éª¨æ¶æ ¡éªŒ

---

### 3.2 é˜¶æ®µäºŒï¼šå‚æ•°å¡«å……

**ç›®æ ‡æ–‡ä»¶**: `src/app/api/plan/route.ts` (é‡æ„)

**è¾“å…¥**: FlowSkeleton + ç”¨æˆ·æè¿°
**è¾“å‡º**: å®Œæ•´ Flow JSON

**ä»»åŠ¡**:
- [ ] è®¾è®¡å‚æ•°å¡«å…… prompt
- [ ] å®ç° JSON ç”Ÿæˆé€»è¾‘
- [ ] åˆå¹¶ä¸¤é˜¶æ®µè¾“å‡º

---

### 3.3 å®æ—¶éªŒè¯åé¦ˆ

**ç›®æ ‡æ–‡ä»¶**: `src/lib/validation/streamingValidator.ts` (æ–°æ–‡ä»¶)

```typescript
export class StreamingValidator {
  private buffer = '';
  
  // å°è¯•è§£æéƒ¨åˆ† JSON
  tryParsePartial(chunk: string): PartialFlow | null;
  
  // æ ¡éªŒå•ä¸ªèŠ‚ç‚¹
  validateNode(node: unknown): ValidationError[];
  
  // ç”Ÿæˆä¿®æ­£æç¤º
  generateCorrectionHint(errors: ValidationError[]): string;
}
```

**ä»»åŠ¡**:
- [ ] å®ç° `StreamingValidator` ç±»
- [ ] é›†æˆåˆ°æµå¼ç”Ÿæˆå¾ªç¯
- [ ] æµ‹è¯•é”™è¯¯ä¿®æ­£æ•ˆæœ

---

## Phase 4: åŒæ­¥æ£€æŸ¥æœºåˆ¶

### 4.1 è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬

**ç›®æ ‡æ–‡ä»¶**: `scripts/check-prompt-sync.ts` (æ–°æ–‡ä»¶)

**åŠŸèƒ½**:
1. è§£æ `docs/design/*.md` æå–å‚æ•°å®šä¹‰
2. è§£æ `src/lib/prompts/*.ts` æå–æè¿°çš„å‚æ•°
3. å¯¹æ¯”å·®å¼‚ï¼Œè¾“å‡ºæŠ¥å‘Š
4. æœ‰å·®å¼‚æ—¶è¿”å›éé›¶é€€å‡ºç 

**ä»»åŠ¡**:
- [ ] å®ç°è®¾è®¡æ–‡æ¡£è§£æå™¨
- [ ] å®ç° prompt æ–‡ä»¶è§£æå™¨
- [ ] å®ç°å·®å¼‚å¯¹æ¯”é€»è¾‘
- [ ] æ·»åŠ  npm script: `check:prompt-sync`

---

### 4.2 Git Hook é›†æˆ

**ç›®æ ‡æ–‡ä»¶**: `.husky/pre-commit` (æ›´æ–°æˆ–åˆ›å»º)

```bash
#!/bin/sh
npm run check:prompt-sync
```

**ä»»åŠ¡**:
- [ ] å®‰è£… husky (å¦‚æœªå®‰è£…)
- [ ] é…ç½® pre-commit hook
- [ ] æµ‹è¯• hook è§¦å‘

---

### 4.3 ç‰ˆæœ¬æ ‡è®°ç³»ç»Ÿ

**ç›®æ ‡æ–‡ä»¶**: æ‰€æœ‰ prompt æ–‡ä»¶å’Œè®¾è®¡æ–‡æ¡£

**æ ¼å¼**:
```typescript
// src/lib/prompts/nodeSpecs.ts
/**
 * @sync-version 2026-01-01
 * @synced-with docs/design/inputèŠ‚ç‚¹è¯¦æƒ….md, docs/design/llmèŠ‚ç‚¹è¯¦æƒ….md, ...
 */
```

```markdown
<!-- docs/design/inputèŠ‚ç‚¹è¯¦æƒ….md -->
<!-- @sync-version: 2026-01-01 -->
<!-- @synced-with: src/lib/prompts/nodeSpecs.ts -->
```

**ä»»åŠ¡**:
- [ ] ä¸ºæ‰€æœ‰ prompt æ–‡ä»¶æ·»åŠ ç‰ˆæœ¬æ ‡è®°
- [ ] ä¸ºæ‰€æœ‰è®¾è®¡æ–‡æ¡£æ·»åŠ ç‰ˆæœ¬æ ‡è®°
- [ ] æ›´æ–°æ£€æŸ¥è„šæœ¬éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§

---

## Phase 5: è¯„ä¼°åŸºå‡†å»ºç«‹

### 5.1 æµ‹è¯•ç”¨ä¾‹é›†

**ç›®æ ‡æ–‡ä»¶**: `tests/plan-generation/testCases.ts` (æ–°æ–‡ä»¶)

**æµ‹è¯•ç”¨ä¾‹ç»“æ„**:
```typescript
interface TestCase {
  id: string;
  input: string;                    // ç”¨æˆ·è¾“å…¥
  expected: {
    minNodes?: number;              // æœ€å°‘èŠ‚ç‚¹æ•°
    maxNodes?: number;              // æœ€å¤šèŠ‚ç‚¹æ•°
    mustHaveTypes?: NodeType[];     // å¿…é¡»åŒ…å«çš„èŠ‚ç‚¹ç±»å‹
    mustNotHaveTypes?: NodeType[];  // ç¦æ­¢åŒ…å«çš„èŠ‚ç‚¹ç±»å‹
    inputConfig?: {
      hasFileUpload?: boolean;
      hasForm?: boolean;
    };
    llmConfig?: {
      hasMemory?: boolean;
      hasJsonFormat?: boolean;
    };
    ragConfig?: {
      hasVariable?: boolean;
    };
  };
}
```

**ä»»åŠ¡**:
- [ ] è®¾è®¡æµ‹è¯•ç”¨ä¾‹ç»“æ„
- [ ] ç¼–å†™ 20 ä¸ªæµ‹è¯•ç”¨ä¾‹
- [ ] å®ç°æµ‹è¯•æ‰§è¡Œå™¨

---

### 5.2 æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨

| ID | è¾“å…¥æè¿° | éªŒè¯è¦ç‚¹ |
|----|---------|---------|
| T01 | "å¸®æˆ‘ç¿»è¯‘" | 3èŠ‚ç‚¹, input+llm+output |
| T02 | "å®¢æœæœºå™¨äºº" | llm.enableMemory=true |
| T03 | "åˆ†ææˆ‘çš„PDF" | æœ‰RAG, input.fileUpload=true |
| T04 | "æœç´¢æœ€æ–°æ–°é—»" | æœ‰Tool(web_search) |
| T05 | "ä»Šå¤©æ˜¯å‡ å·" | æœ‰Tool(datetime) |
| T06 | "æ ¹æ®æ¡ä»¶åˆ†æµ" | æœ‰BranchèŠ‚ç‚¹ |
| T07 | "ç”Ÿæˆå›¾ç‰‡" | æœ‰ImageGenèŠ‚ç‚¹ |
| T08 | "è¿è¡ŒPythonä»£ç " | æœ‰Tool(code_interpreter) |
| T09 | "è¯»å–ç½‘é¡µå†…å®¹" | æœ‰Tool(url_reader) |
| T10 | "è®¡ç®—æ•°å­¦é¢˜" | æœ‰Tool(calculator) |
| ... | ... | ... |

**ä»»åŠ¡**:
- [ ] T01-T10 åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] T11-T15 ç»„åˆåŠŸèƒ½æµ‹è¯•
- [ ] T16-T20 å¤æ‚åœºæ™¯æµ‹è¯•

---

### 5.3 è‡ªåŠ¨åŒ–è¯„ä¼°è„šæœ¬

**ç›®æ ‡æ–‡ä»¶**: `scripts/evaluate-plan-gen.ts` (æ–°æ–‡ä»¶)

**åŠŸèƒ½**:
1. æ‰¹é‡æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹
2. å¯¹æ¯”ç”Ÿæˆç»“æœä¸é¢„æœŸ
3. è®¡ç®—é€šè¿‡ç‡å’Œé”™è¯¯åˆ†å¸ƒ
4. ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š

**è¾“å‡ºç¤ºä¾‹**:
```
Plan Generation Evaluation Report
================================
Total: 20 cases
Passed: 17 (85%)
Failed: 3 (15%)

Failed Cases:
- T06: ç¼ºå°‘ Branch èŠ‚ç‚¹
- T12: RAG æœªé…ç½® retrievalVariable
- T18: LLM systemPrompt è¿‡äºç©ºæ´

Error Distribution:
- èŠ‚ç‚¹ç±»å‹ç¼ºå¤±: 2
- å‚æ•°é…ç½®é”™è¯¯: 1
```

**ä»»åŠ¡**:
- [ ] å®ç°è¯„ä¼°æ‰§è¡Œå™¨
- [ ] å®ç°ç»“æœå¯¹æ¯”é€»è¾‘
- [ ] å®ç°æŠ¥å‘Šç”Ÿæˆå™¨
- [ ] æ·»åŠ  npm script: `evaluate:plan-gen`

---

## æ‰§è¡Œæ£€æŸ¥æ¸…å•

### å¼€å§‹å‰å‡†å¤‡
- [ ] åˆ›å»ºå¼€å‘åˆ†æ”¯ `feat/plan-gen-optimization`
- [ ] é˜…è¯»ç°æœ‰ prompt æ–‡ä»¶
- [ ] é˜…è¯»ç°æœ‰è®¾è®¡æ–‡æ¡£

### Phase 1 å®Œæˆæ ‡å¿—
- [ ] `smartRules.ts` å·²æ›´æ–°
- [ ] `scenarioRules.ts` å·²æ›´æ–°
- [ ] 5 ä¸ªåœºæ™¯æµ‹è¯•é€šè¿‡

### Phase 2 å®Œæˆæ ‡å¿—
- [ ] `examples/` ç›®å½•å·²åˆ›å»º
- [ ] 17 ä¸ªç¤ºä¾‹å·²ç¼–å†™
- [ ] ç¤ºä¾‹é€‰æ‹©é€»è¾‘å·²å®ç°
- [ ] é›†æˆåˆ° `plan/route.ts`

### Phase 3 å®Œæˆæ ‡å¿—
- [ ] ä¸¤é˜¶æ®µç”Ÿæˆå·²å®ç°
- [ ] æµå¼éªŒè¯å·²å®ç°
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡

### Phase 4 å®Œæˆæ ‡å¿—
- [ ] æ£€æŸ¥è„šæœ¬å·²å®ç°
- [ ] Git hook å·²é…ç½®
- [ ] ç‰ˆæœ¬æ ‡è®°å·²æ·»åŠ 

### Phase 5 å®Œæˆæ ‡å¿—
- [ ] 20 ä¸ªæµ‹è¯•ç”¨ä¾‹å·²ç¼–å†™
- [ ] è¯„ä¼°è„šæœ¬å·²å®ç°
- [ ] åŸºçº¿é€šè¿‡ç‡å·²è®°å½•

---

## é™„å½•ï¼šå…³é”®æ–‡ä»¶ç´¢å¼•

| ç±»å‹ | æ–‡ä»¶è·¯å¾„ |
|-----|---------|
| Prompt è§„åˆ™ | `src/lib/prompts/smartRules.ts` |
| åœºæ™¯è§„åˆ™ | `src/lib/prompts/scenarioRules.ts` |
| èŠ‚ç‚¹è§„èŒƒ | `src/lib/prompts/nodeSpecs.ts` |
| ç¤ºä¾‹åº“ | `src/lib/prompts/examples/*.ts` |
| Plan API | `src/app/api/plan/route.ts` |
| æµå¼éªŒè¯ | `src/lib/validation/streamingValidator.ts` |
| åŒæ­¥æ£€æŸ¥ | `scripts/check-prompt-sync.ts` |
| è¯„ä¼°è„šæœ¬ | `scripts/evaluate-plan-gen.ts` |
| æµ‹è¯•ç”¨ä¾‹ | `tests/plan-generation/testCases.ts` |
